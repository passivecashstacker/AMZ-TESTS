chrome.action.onClicked.addListener(function(e){chrome.scripting.executeScript({target:{tabId:e.id},files:["./lib/js/popupInjector.js"]},function(){chrome.tabs.sendMessage(e.id,{type:"init"})})});var o=0;const n="https://extension.fluencerfruit.com";chrome.runtime.onMessage.addListener(function(t,e,s){switch(t.type){case"getProductPage":!function e(t,s,n){o<7?(o++,fetch(t).then(function(e){return o--,e.text()}).then(function(e){s({url:t,data:e,index:n})}).catch(()=>{s({url:t,data:null,index:n}),o--})):setTimeout(function(){e(t,s,n)},2e3)}(t.url,s,t.index);break;case"fetchScore":chrome.storage.local.get("sessionID").then(({sessionID:e})=>{fetch(n+"/calculateScore",{method:"POST",headers:{"Content-Type":"application/json","x-session-id":e},body:JSON.stringify({products:t.fetchedScoresObjs})}).then(e=>e.json()).then(e=>{s(e)})});break;case"login":try{fetch(n+"/auth/signin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t.email,password:t.password})}).then(e=>e.json()).then(async e=>{chrome.storage.local.set({sessionID:e.sessionID}).then(()=>{s(e)})}).catch(e=>{s(e)})}catch(e){s({msg:e})}break;case"checkout":try{chrome.storage.local.get("sessionID").then(({sessionID:e})=>{fetch(n+"/checkout/"+t.id,{headers:{"x-session-id":e},method:"GET"}).then(e=>e.json()).then(e=>{s(e)}).catch(e=>{s(e)})})}catch(e){s({msg:e})}break;case"signup":try{fetch(n+"/auth/signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t.email,password:t.password,name:t.name})}).then(e=>e.json()).then(e=>{s(e)}).catch(e=>{s(e)})}catch(e){s({msg:e})}break;case"prices":try{fetch(n+"/prices").then(e=>e.json()).then(e=>s(e)).catch(e=>s({msg:e}))}catch(e){s({msg:e})}break;case"forgot":try{fetch(n+"/auth/requestResetPassword",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t.email})}).then(e=>e.json()).then(e=>{s(e)}).catch(e=>{s(e)})}catch(e){s({msg:e})}break;case"check":try{chrome.storage.local.get("sessionID").then(({sessionID:e})=>{fetch(n+"/me",{method:"GET",headers:{"x-session-id":e}}).then(e=>e.json()).then(e=>{s(e)}).catch(e=>{s(e)})})}catch(e){s({msg:e})}break;case"logout":try{chrome.storage.local.get("sessionID").then(({sessionID:e})=>{fetch(n+"/auth/logout",{method:"GET",headers:{"x-session-id":e}}).then(e=>e.json()).then(e=>{chrome.storage.local.remove("sessionID").then(()=>{s(e)})}).catch(e=>{s(e)})})}catch(e){s({msg:e})}}return!0});